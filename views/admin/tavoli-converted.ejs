      <!-- Page header -->
      <div class="page-header">
        <h1>
          <i class="fas fa-utensils"></i>
          Tavoli Approvati
        </h1>
        <p>Panoramica completa dei tavoli confermati e gestiti</p>
      </div>

      <!-- Stats cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Tavoli Totali</h3>
            <div class="icon tables">
              <i class="fas fa-table"></i>
            </div>
          </div>
          <div class="number" id="total-tables">
            <%= tavoli.length %>
          </div>
          <div class="label">Tavoli confermati</div>
        </div>

        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Ricavi Totali</h3>
            <div class="icon revenue">
              <i class="fas fa-euro-sign"></i>
            </div>
          </div>
          <div class="number" id="total-revenue">
            â‚¬ <%= tavoli.reduce((sum, t) => sum + parseFloat(t.spesa_prevista || 0), 0).toFixed(2) %>
          </div>
          <div class="label">Fatturato generato</div>
        </div>

        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Ospiti Totali</h3>
            <div class="icon guests">
              <i class="fas fa-users"></i>
            </div>
          </div>
          <div class="number" id="total-guests">
            <%= tavoli.reduce((sum, t) => sum + parseInt(t.numero_persone || 0), 0) %>
          </div>
          <div class="label">Persone servite</div>
        </div>

        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Oggi</h3>
            <div class="icon today">
              <i class="fas fa-calendar-day"></i>
            </div>
          </div>
          <div class="number" id="today-tables">
            <%= tavoli.filter(t => t.data === new Date().toISOString().split('T')[0]).length %>
          </div>
          <div class="label">Tavoli di oggi</div>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters-section">
        <form method="get" action="/admin/tavoli">
          <div class="filters-grid">
            <div class="filter-group">
              <label>
                <i class="fas fa-calendar"></i>
                Filtra per data:
              </label>
              <input type="date" name="data" class="filter-control" value="<%= filtroData || '' %>">
            </div>

            <div class="filter-group">
              <button type="submit" class="btn-filter">
                <i class="fas fa-filter"></i>
                Filtra
              </button>
            </div>

            <% if (filtroData) { %>
              <div class="filter-group">
                <a href="/admin/tavoli" class="btn-filter" style="background: #6b7280; text-decoration: none;">
                  <i class="fas fa-times"></i>
                  Rimuovi filtro
                </a>
              </div>
            <% } %>
          </div>
        </form>
      </div>

      <!-- Tables section -->
      <div class="tables-section">
        <div class="tables-header">
          <h2>
            <i class="fas fa-list"></i>
            Lista Tavoli Approvati
          </h2>
          <button type="button" class="export-btn" onclick="exportToCSV()">
            <i class="fas fa-download"></i>
            Esporta CSV
          </button>
        </div>

        <% if (tavoli.length === 0) { %>
          <div class="empty-state">
            <i class="fas fa-utensils"></i>
            <h3>Nessun tavolo approvato</h3>
            <p>Non ci sono tavoli approvati al momento.</p>
          </div>
        <% } else { %>
          <div class="table-container">
            <table class="tables-table" id="tables-table">
              <thead>
                <tr>
                  <th><i class="fas fa-calendar"></i> Data</th>
                  <th><i class="fas fa-table"></i> Nome Tavolo</th>
                  <th><i class="fas fa-user-tie"></i> PR</th>
                  <th><i class="fas fa-users"></i> Persone</th>
                  <th><i class="fas fa-euro-sign"></i> Spesa Prevista</th>
                  <th><i class="fas fa-gift"></i> Omaggi</th>
                  <th><i class="fas fa-sticky-note"></i> Note</th>
                  <th><i class="fas fa-flag"></i> Stato</th>
                </tr>
              </thead>
              <tbody>
                <% tavoli.forEach(tavolo => { %>
                  <tr class="<%= tavolo.modificata ? 'tavolo-modificato' : '' %>">
                    <td>
                      <span class="date-value">
                        <%= new Date(tavolo.data).toLocaleDateString('it-IT', { 
                          weekday: 'short', 
                          year: 'numeric', 
                          month: 'short', 
                          day: 'numeric' 
                        }) %>
                      </span>
                    </td>
                    <td>
                      <strong><%= tavolo.nome_tavolo %></strong>
                    </td>
                    <td>
                      <span class="pr-name"><%= tavolo.pr_nickname %></span>
                      <div style="font-size: 0.8rem; color: #666;">
                        <%= tavolo.pr_nome %> <%= tavolo.pr_cognome %>
                      </div>
                    </td>
                    <td>
                      <span class="status-badge" style="background: rgba(102, 126, 234, 0.1); color: #667eea;">
                        <i class="fas fa-users"></i>
                        <%= tavolo.numero_persone %>
                      </span>
                    </td>
                    <td>
                      <span class="revenue-value">â‚¬ <%= parseFloat(tavolo.spesa_prevista || 0).toFixed(2) %></span>
                    </td>
                    <td>
                      <% if (tavolo.omaggi && tavolo.omaggi.trim() !== "") { %>
                        <% tavolo.omaggi.split(',').forEach(function(omaggio) { %>
                          <span class="omaggi-badge"><%= omaggio.trim() %></span>
                        <% }) %>
                      <% } else { %>
                        <span style="color: #999; font-style: italic;">Nessuno</span>
                      <% } %>
                    </td>
                    <td>
                      <% if (tavolo.note_tavolo && tavolo.note_tavolo.trim() !== "") { %>
                        <%= tavolo.note_tavolo %>
                      <% } else { %>
                        <span style="color: #999; font-style: italic;">Nessuna nota</span>
                      <% } %>
                      <% if (tavolo.modificata && tavolo.note_modifiche) { %>
                        <div class="note-modifiche-storico">
                          <i class="fas fa-edit"></i>
                          <strong>Modificato da <%= tavolo.modificato_da_nickname || 'Admin' %>:</strong> 
                          <%= tavolo.note_modifiche %>
                        </div>
                      <% } %>
                    </td>
                    <td>
                      <% if (tavolo.modificata) { %>
                        <span class="badge modificato">
                          <i class="fas fa-edit"></i> Modificato
                        </span>
                      <% } %>
                      <span class="badge approvato">
                        <i class="fas fa-check"></i> Approvato
                      </span>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </div>
    </div>
  </main>

  <script>
    // Mobile menu toggle
    const hamburger = document.getElementById('hamburger');
    const adminSidebar = document.getElementById('adminSidebar');
    const mobileOverlay = document.getElementById('mobileOverlay');

    function toggleMobileMenu() {
      hamburger.classList.toggle('active');
      adminSidebar.classList.toggle('open');
      mobileOverlay.classList.toggle('show');
      document.body.style.overflow = adminSidebar.classList.contains('open') ? 'hidden' : '';
    }

    function closeMobileMenu() {
      hamburger.classList.remove('active');
      adminSidebar.classList.remove('open');
      mobileOverlay.classList.remove('show');
      document.body.style.overflow = '';
    }

    hamburger.addEventListener('click', toggleMobileMenu);
    mobileOverlay.addEventListener('click', closeMobileMenu);

    // Close mobile menu when clicking on a link
    const sidebarLinks = document.querySelectorAll('.sidebar-nav a');
    sidebarLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
          closeMobileMenu();
        }
      });
    });

    // Handle window resize
    window.addEventListener('resize', () => {
      if (window.innerWidth > 768) {
        closeMobileMenu();
      }
    });

    // Dati tavoli per l'export
    const allTables = JSON.parse('<%- JSON.stringify(tavoli) %>');

    function exportToCSV() {
      const headers = ['Data', 'Nome Tavolo', 'PR', 'Persone', 'Spesa Prevista', 'Omaggi', 'Note', 'Stato'];
      const csvData = [headers];

      allTables.forEach(tavolo => {
        csvData.push([
          tavolo.data,
          tavolo.nome_tavolo,
          `${tavolo.pr_nickname} (${tavolo.pr_nome} ${tavolo.pr_cognome})`,
          tavolo.numero_persone,
          parseFloat(tavolo.spesa_prevista || 0).toFixed(2),
          tavolo.omaggi || '',
          tavolo.note_tavolo || '',
          tavolo.modificata ? 'Modificato e Approvato' : 'Approvato'
        ]);
      });

      const csvString = csvData.map(row => 
        row.map(field => `"${field}"`).join(',')
      ).join('\n');

      const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      
      if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `tavoli_approvati_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    }

    console.log('ðŸš€ ICONIC Tavoli caricato!');
  </script>
