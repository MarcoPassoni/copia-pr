      <!-- Page header -->
      <div class="page-header">
        <h1>
          <i class="fas fa-check-circle"></i>
          Richieste e Approvazioni
        </h1>
        <p>Gestisci le richieste tavoli del team Aura</p>
      </div>

      <!-- Stats cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-card-header">
            <h3>In Attesa</h3>
            <div class="icon pending">
              <i class="fas fa-clock"></i>
            </div>
          </div>
          <div class="number">
            <%= richieste.filter(r => !r.modificata && !r.approvata && !r.rifiutata).length %>
          </div>
          <div class="label">Richieste da valutare</div>
        </div>

        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Modificate</h3>
            <div class="icon approved">
              <i class="fas fa-edit"></i>
            </div>
          </div>
          <div class="number">
            <%= richieste.filter(r => r.modificata).length %>
          </div>
          <div class="label">Richieste modificate</div>
        </div>

        <div class="stat-card">
          <div class="stat-card-header">
            <h3>Approvate</h3>
            <div class="icon approved">
              <i class="fas fa-check"></i>
            </div>
          </div>
          <div class="number">
            <%= richieste.filter(r => r.approvata).length %>
          </div>
          <div class="label">Richieste approvate</div>
        </div>
      </div>

      <!-- Requests section -->
      <div class="requests-section">
        <div class="requests-header">
          <h2>
            <i class="fas fa-list-ul"></i>
            Richieste Tavoli
          </h2>
        </div>

        <% if (richieste.length === 0) { %>
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h3>Nessuna richiesta trovata</h3>
            <p>Non ci sono richieste di prenotazione tavoli al momento.</p>
          </div>
        <% } else { %>
          <div class="table-container">
            <table class="requests-table">
              <thead>
                <tr>
                  <th><i class="fas fa-user-tie"></i> PR</th>
                  <th><i class="fas fa-calendar"></i> Data</th>
                  <th><i class="fas fa-users"></i> Persone</th>
                  <th><i class="fas fa-euro-sign"></i> Spesa</th>
                  <th><i class="fas fa-gift"></i> Omaggi</th>
                  <th><i class="fas fa-table"></i> Tavolo</th>
                  <th><i class="fas fa-sticky-note"></i> Note</th>
                  <th><i class="fas fa-flag"></i> Stato</th>
                  <th><i class="fas fa-cogs"></i> Azioni</th>
                </tr>
              </thead>
              <tbody>
                <% richieste.forEach(r => { %>
                  <tr class="<%= r.modificata ? 'modificata' : '' %>">
                    <td>
                      <strong><%= r.pr_nickname %></strong>
                    </td>
                    <td><%= r.data %></td>
                    <td>
                      <span class="badge" style="background: rgba(102, 126, 234, 0.1); color: #667eea;">
                        <%= r.numero_persone %>
                      </span>
                    </td>
                    <td>
                      <strong style="color: #10b981;">â‚¬ <%= r.spesa_prevista %></strong>
                    </td>
                    <td>
                      <% if (r.omaggi && r.omaggi.trim() !== "") { %>
                        <% r.omaggi.split(',').forEach(function(omaggio) { %>
                          <span class="omaggi-badge"><%= omaggio.trim() %></span>
                        <% }) %>
                      <% } else { %>
                        <span style="color: #999; font-style: italic;">Nessuno</span>
                      <% } %>
                    </td>
                    <td>
                      <strong><%= r.nome_tavolo %></strong>
                    </td>
                    <td>
                      <% if (r.note_tavolo) { %>
                        <%= r.note_tavolo %>
                      <% } %>
                      <% if (r.modificata && r.note_modifiche) { %>
                        <div class="note-modifiche">
                          <i class="fas fa-edit"></i>
                          <strong>Modificato da <%= r.modificato_da_nickname || 'Admin' %>:</strong> 
                          <%= r.note_modifiche %>
                        </div>
                      <% } %>
                    </td>
                    <td>
                      <% if (r.modificata) { %>
                        <span class="badge modificato">
                          <i class="fas fa-edit"></i> Modificato
                        </span>
                      <% } else { %>
                        <span class="badge attesa">
                          <i class="fas fa-clock"></i> In attesa
                        </span>
                      <% } %>
                    </td>
                    <td>
                      <div class="action-buttons">
                        <button class="btn-action modifica-btn" onclick="openModifyModal(<%= r.id %>)" 
                                data-id="<%= r.id %>"
                                data-pr_nickname="<%= r.pr_nickname %>"
                                data-data="<%= r.data %>"
                                data-numero_persone="<%= r.numero_persone %>"
                                data-spesa_prevista="<%= r.spesa_prevista %>"
                                data-omaggi="<%= r.omaggi || '' %>"
                                data-nome_tavolo="<%= r.nome_tavolo %>"
                                data-note_tavolo="<%= r.note_tavolo || '' %>"
                                data-note_modifiche="<%= r.note_modifiche || '' %>">
                          <i class="fas fa-edit"></i>
                          Modifica
                        </button>
                        <form method="POST" action="/admin/approvazioni/approva" style="display:inline;">
                          <input type="hidden" name="id" value="<%= r.id %>">
                          <button type="submit" class="btn-action approva-btn">
                            <i class="fas fa-check"></i>
                            Approva
                          </button>
                        </form>
                        <form method="POST" action="/admin/approvazioni/rifiuta" style="display:inline;">
                          <input type="hidden" name="id" value="<%= r.id %>">
                          <button type="submit" class="btn-action rifiuta-btn">
                            <i class="fas fa-times"></i>
                            Rifiuta
                          </button>
                        </form>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </div>
    </div>
  </main>

  <!-- Modal modifica prenotazione -->
  <div id="modifyModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>
        <i class="fas fa-edit"></i>
        Modifica Prenotazione Tavolo
      </h2>
      <form id="modifyForm" method="POST" action="/admin/approvazioni/modifica">
        <input type="hidden" id="modify-id" name="id">
        
        <div class="form-row">
          <label>
            <i class="fas fa-user-tie"></i>
            PR: <span id="modify-pr-display" style="color: #667eea; font-weight: 600;"></span>
          </label>
        </div>
        
        <div class="form-row">
          <label>
            <i class="fas fa-calendar"></i>
            Data:
          </label>
          <input type="date" id="modify-data" name="data" required>
        </div>
        
        <div class="form-row">
          <label>
            <i class="fas fa-users"></i>
            Numero Persone:
          </label>
          <input type="number" id="modify-persone" name="numero_persone" min="1" required>
        </div>
        
        <div class="form-row">
          <label>
            <i class="fas fa-euro-sign"></i>
            Spesa Prevista (â‚¬):
          </label>
          <input type="number" id="modify-spesa" name="spesa_prevista" min="0" step="0.01" required>
        </div>
        
        <div class="form-row">
          <label>
            <i class="fas fa-table"></i>
            Nome Tavolo:
          </label>
          <input type="text" id="modify-nome-tavolo" name="nome_tavolo" required>
        </div>
        
        <div class="form-row">
          <label>
            <i class="fas fa-gift"></i>
            Omaggi (separati da virgola):
          </label>
          <input type="text" id="modify-omaggi" name="omaggi" placeholder="Es: Bottiglia champagne, Dolci...">
        </div>
        
        <div class="form-row">
          <label>
            <i class="fas fa-sticky-note"></i>
            Note Tavolo:
          </label>
          <textarea id="modify-note-tavolo" name="note_tavolo" rows="3" placeholder="Note aggiuntive per il tavolo..."></textarea>
        </div>
        
        <div class="form-row">
          <label>
            <i class="fas fa-edit"></i>
            Note Modifiche (motivo delle modifiche):
          </label>
          <textarea id="modify-note-modifiche" name="note_modifiche" rows="2" placeholder="Descrivi le modifiche apportate..." required></textarea>
        </div>
        
        <div class="modal-buttons">
          <button type="submit" class="save-btn">
            <i class="fas fa-save"></i>
            Salva Modifiche
          </button>
          <button type="button" onclick="closeModifyModal()" class="cancel-btn">
            <i class="fas fa-times"></i>
            Annulla
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Mobile menu toggle
    const hamburger = document.getElementById('hamburger');
    const adminSidebar = document.getElementById('adminSidebar');
    const mobileOverlay = document.getElementById('mobileOverlay');

    function toggleMobileMenu() {
      hamburger.classList.toggle('active');
      adminSidebar.classList.toggle('open');
      mobileOverlay.classList.toggle('show');
      document.body.style.overflow = adminSidebar.classList.contains('open') ? 'hidden' : '';
    }

    function closeMobileMenu() {
      hamburger.classList.remove('active');
      adminSidebar.classList.remove('open');
      mobileOverlay.classList.remove('show');
      document.body.style.overflow = '';
    }

    hamburger.addEventListener('click', toggleMobileMenu);
    mobileOverlay.addEventListener('click', closeMobileMenu);

    // Close mobile menu when clicking on a link
    const sidebarLinks = document.querySelectorAll('.sidebar-nav a');
    sidebarLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
          closeMobileMenu();
        }
      });
    });

    // Handle window resize
    window.addEventListener('resize', () => {
      if (window.innerWidth > 768) {
        closeMobileMenu();
      }
    });

    // Modal functionality
    const modifyModal = document.getElementById('modifyModal');
    const closeBtn = document.querySelector('.close');
    
    function openModifyModal(richiestaId) {
      const button = document.querySelector(`[data-id="${richiestaId}"]`);
      
      // Popola il form con i dati attuali
      document.getElementById('modify-id').value = richiestaId;
      document.getElementById('modify-pr-display').textContent = button.dataset.pr_nickname;
      document.getElementById('modify-data').value = button.dataset.data;
      document.getElementById('modify-persone').value = button.dataset.numero_persone;
      document.getElementById('modify-spesa').value = button.dataset.spesa_prevista;
      document.getElementById('modify-nome-tavolo').value = button.dataset.nome_tavolo;
      document.getElementById('modify-omaggi').value = button.dataset.omaggi;
      document.getElementById('modify-note-tavolo').value = button.dataset.note_tavolo;
      document.getElementById('modify-note-modifiche').value = button.dataset.note_modifiche;
      
      // Mostra il modal
      modifyModal.style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    
    function closeModifyModal() {
      modifyModal.style.display = 'none';
      document.body.style.overflow = '';
    }
    
    // Chiudi modal cliccando sulla X
    closeBtn.addEventListener('click', closeModifyModal);
    
    // Chiudi modal cliccando fuori
    window.addEventListener('click', function(event) {
      if (event.target === modifyModal) {
        closeModifyModal();
      }
    });

    // Chiudi modal con ESC
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && modifyModal.style.display === 'block') {
        closeModifyModal();
      }
    });

    console.log('ðŸš€ Aura Approvazioni caricato!');
  </script>
